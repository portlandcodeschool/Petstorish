!!!5
%html
  %head
    %title Petstorish
    = stylesheet_link_tag    "application", :media => "all"
    = javascript_include_tag "application"
    = csrf_meta_tags
  %body
    ///////////////////////////////////////////////////////////
    //  SEARCH OVERLAY
    //////////////////////////////////////////////////////////
    #overlay-container
      :javascript
        var opacityTimer;
        var op = 0.0;
        var overlayDiv = $('#overlay-container');
        function fadeIn()
        {
          if(op> 1)
          {
            clearInterval(opacityTimer);
            overlayDiv.css({opacity: 1});
          }
          else
          {
            op = op + 0.05;
            overlayDiv.css({opacity: op});
            console.log(op)
          }

        }
        function fadeOut()
        {
          if(op < 0.1)
          {
            overlayDiv.css({display: 'none'});


            clearInterval(opacityTimer);
          }
          else
          {
            op = op - 0.05;
            overlayDiv.css({opacity: op});
            console.log(op)
          }

        }
        function hideOverlay(){
          clearInterval(opacityTimer);
          opacityTimer = setInterval(fadeOut,2);
        }
        function showOverlay(){

          console.log('showOverLay')
          clearInterval(opacityTimer)
          overlayDiv.show();
          $('.input-overlay').css({
            top:'30%',
            left:'50%',
            margin:'-'+($('.input-overlay').height() / 2)+
            'px 0 0 -'+($('.input-overlay').width() / 2)+'px'
            });

            opacityTimer = setInterval(fadeIn, 2);
        }

      .overlay
      .input-overlay
        %h2 Search
        .search
          =form_tag("/s/", :method => "get") do

            = text_field_tag :query

            .checkboxen
              search in:
              %p
                = check_box_tag 'options[]', 'name', true
                Name

              %p
                = check_box_tag 'options[]', 'description', true
                Description

            .field
              price:
              .price
                minimum
                %p= select('price', 'minimum', (0..100).step(10))
              .price
                maximum
                %p= select('price', 'maximum', (0..100).step(10), :selected => 100)
              .price
                category
                %p= select('category', 'name', ['all'] | Product.categories, :selected => 'all') 
              .button
                =submit_tag("search", :id => 'OverlaySearchButton')
            .close
              %a{:href=>'#', :onClick => "hideOverlay();"} close
      //////////////////////////////////////////////////////////
      //  HEADER
      /////////////////////////////////////////////////////////

    .container
      .row
        .span12.shorter-span
          .header.clearfix
            /%img{:src => '/assets/design/top_border.png'}
            .title
              =link_to 'Petstore', root_path 
          .header-border
            .cat
            .right.pull-right
              .cart
                %a{:href => '#'} Shopping Cart
              .basic-search
                =form_tag("/s/", :method => "get") do
                  =text_field_tag(:query, nil, :class => "simple-search")
                  .options
                    .link
                      %a{:href=>"#", :onClick => "showOverlay()"}Advanced Search
                    .button
                      =submit_tag("search", :id => 'SearchButton')
      .row.middle
        .span2.sidebar
          %ul
            -Product.categories.each do |cat|
              %li
                =link_to cat, '/'+cat

        .span9.main
          - if flash[:notice]
            .notice
              %h2= flash[:notice]
          - errors = flash[:errors]
          - if errors
            #error_explanation
              %h2= "#{pluralize(errors.count, "error")} prevented this action:"
              %ul
                - errors.each do |attribute, msg|
                  %li= "#{attribute} #{msg[0]}"

          = yield

      .row
        .span12
          .footer
            %ul
              %li
                contact
              %li
                address place <br />
                123 wonderful lane <br />
                Tropical Wisconsin <br />
              %li
                this is a site map
  :javascript
    $("#SearchButton").click(function(event) {
      event.preventDefault();
      window.location = "/s/"+$(".simple-search").val();
      });


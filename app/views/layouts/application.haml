!!!5
%html
  %head
    %title Petstorish
    = stylesheet_link_tag    "application", :media => "all"
    = javascript_include_tag "application"
    = csrf_meta_tags
  %body{:onload => 'goFish();'}
    ///////////////////////////////////////////////////////////
    //  SEARCH OVERLAY
    //////////////////////////////////////////////////////////
    #overlay-container
      :javascript
        var opacityTimer;
        var op = 0.0;
        var overlayDiv = $('#overlay-container');
        function fadeIn()
        {
          if(op> 1)
          {
            clearInterval(opacityTimer);
            overlayDiv.css({opacity: 1});
          }
          else
          {
            op = op + 0.05;
            overlayDiv.css({opacity: op});
            console.log(op)
          }

        }
        function fadeOut()
        {
          if(op < 0.1)
          {
            overlayDiv.css({display: 'none'});


            clearInterval(opacityTimer);
          }
          else
          {
            op = op - 0.05;
            overlayDiv.css({opacity: op});
            console.log(op)
          }

        }
        function hideOverlay(){
          clearInterval(opacityTimer);
          opacityTimer = setInterval(fadeOut,2);
        }
        function showOverlay(){

          console.log('showOverLay')
          clearInterval(opacityTimer)
          overlayDiv.show();
          $('.input-overlay').css({
            top:'30%',
            left:'50%',
            margin:'-'+($('.input-overlay').height() / 2)+
            'px 0 0 -'+($('.input-overlay').width() / 2)+'px'
            });

            opacityTimer = setInterval(fadeIn, 2);
        }
        ///////////////////////////////
        /// Fish animation
        //////////////////////////////
        var numFish = 1;
        function goFish()
        {
          for(i=0;i<numFish;i++)
          {
            var fishDiv = $('.fish'+i);
            //122 is fish.png width
            target_x = Math.round(Math.random() * ($('body').width() - 122));
            target_y = Math.round(Math.random() * $('body').height());

            if(target_x < fishDiv.offset().left)
            {
              image_on = 'l'
              image_off = 'r'
            }
            else
            {
              image_on = 'r'
              image_off = 'l'
            }
            //fishDiv.css('background-image', 'url("/assets/design/' + bg_image + '")');
            //Change the z-index of the images here
            $('#fish'+i+image_on).css('opacity', 1);
            $('#fish'+i+image_off).css('opacity', 0);
            fishDiv.animate(
            {
              'left': target_x + 'px',
              'top': target_y + 'px',
              'rotate': '+='+2*Math.PI
            },
            {
              step: function(now,fx)
              {
                if(fx.prop == 'rotate')
                {
                  angle = 15 * Math.sin(10*now);
                  $(this).css('-webkit-transform','rotate('+angle+'deg)');
                }
              },
              duration: Math.round(Math.random()*4000.0 + 1000),
              complete: goFish

            }
            ); //animate
          } // for(i=0)...
        }
        function addFish()
        {
          $('body').append('<div class="fish'+numFish+'"><img class = "fish-image" src="assets/design/goldfish_left.png" id="fish'+numFish+'l" style="opacity:0"><img class="fish-image" src="assets/design/goldfish_right.png" id="fish'+numFish+'r" style="opacity:0"></div>');

          start_x = Math.round(Math.random() * ($('body').width() - 122));
          start_y = Math.round(Math.random() * $('body').height());


          fish = $('.fish'+numFish);
          fish.css('width', '122px');
          fish.css('height', '94px');
          fish.css('position', 'absolute');
          fish.css('top', start_y);
          fish.css('left', start_x);
          fish.css('z-index', 100);

          numFish++;
        }
      .overlay
      .input-overlay
        %h2 Search
        .search
          =form_tag("/s/", :method => "get") do

            = text_field_tag :query

            .checkboxen
              search in:
              %p
                = check_box_tag 'options[]', 'name', true
                Name

              %p
                = check_box_tag 'options[]', 'description', true
                Description

            .field
              price:
              .price
                minimum
                %p= select('price', 'minimum', (0..100).step(10))
              .price
                maximum
                %p= select('price', 'maximum', (0..100).step(10), :selected => 100)
              .price
                category
                %p= select('category', 'name', ['all'] | Product.categories, :selected => 'all')
              .button
                =submit_tag("search", :id => 'OverlaySearchButton')
            .close
              %a{:href=>'#', :onClick => "hideOverlay();"} close
      //////////////////////////////////////////////////////////
      //  HEADER
      /////////////////////////////////////////////////////////

    .container
      .row
        .span12.shorter-span
          .header.clearfix
            /%img{:src => '/assets/design/top_border.png'}
          .header-border
            .title
              =link_to 'Petstore', root_path
            .cat
            .right.pull-right
              .cart
                %a{:href => '/cart'}
                  Cart:
                  %img{:src => '/assets/design/cart.png'}
              .basic-search
                =form_tag("/s/", :method => "get") do
                  =text_field_tag(:query, nil, :class => "simple-search")
                  .options
                    .link
                      %a{:href=>"#", :onClick => "showOverlay()"}Advanced Search
                    .button
                      =submit_tag("search", :id => 'SearchButton')
      .middle.clearfix.padding.upfix
        .sidebar
          -if !user_signed_in?
            .announce
              You are not signed in.
            %ul
              %li
                %a{:href => 'users/sign_in'} Sign in
          -else
            .announce
              You are signed in.
            %ul
              %li
                %a{:href => 'users/sign_out', :'data-method' => 'delete'} Signout

          .announce
            Categories
          %ul
            -Product.categories.each do |cat|
              %li
                =link_to cat, '/'+cat

          .monkey{:onclick => 'addFish();'}
        .main.padding.upfix
          - if flash[:notice]
            .notice
              %h2= flash[:notice]
          - errors = flash[:errors]
          - if errors
            #error_explanation
              %h2= "#{pluralize(errors.count, "error")} prevented this action:"
              %ul
                - errors.each do |attribute, msg|
                  %li= "#{attribute} #{msg[0]}"

          = yield

      .row.margin.upfix
        .span12.shorter-span
          .footer
            %ul
              %li
                contact
              %li
                address place <br />
                123 wonderful lane <br />
                Tropical Wisconsin <br />
              %li
                this is a site map
          .footer-border
            .cat
    .fish0
      %img{:src => '/assets/design/goldfish_right.png', :class => 'fish-image', :id => 'fish0r'}
      %img{:src => '/assets/design/goldfish_left.png', :class => 'fish-image', :id  => 'fish0l'}
  :javascript
    $("#SearchButton").click(function(event) {
      event.preventDefault();
      window.location = "/s/"+$(".simple-search").val();
      });
